!function(){var status=function(){const statusBar=parent.statusBar;return{set:function(){return statusBar&&statusBar.set.apply(statusBar,arguments),this},fade:function(){return statusBar&&statusBar.fade.apply(statusBar,arguments),this}}}(),closeEditor=function(editor){editor.hide();editor.show()},saveConfirmationDialog=function(editor){return editor.windowManager.open({title:translate("Save changes?"),size:"normal",body:{type:"panel",items:[{type:"htmlpanel",html:"<p>"+translate("You have unsaved changes")+"<\/p>"}]},buttons:[{type:"submit",name:"saveBtn",text:translate("Save changes"),primary:!0},{type:"cancel",name:"cancelBtn",text:translate("Return to editor"),primary:!0},{type:"custom",name:"discardChangesBtn",text:translate("Discard changes"),primary:!0}],onSubmit:function(dialogApi){dialogApi.close();saveContent(editor,!1);closeEditor(editor)},onCancel:function(){editor.fire("focus",editor.getBody())},onAction:function(dialogApi){dialogApi.close();discardChanges(editor)}})},saveContent=function(editor,confirmSave,callbacks){const element=editor.getBody(),id=element.getAttribute("data-id"),content=editor.getContent();if(!editor.isDirty())return!0;if(confirmSave==!0)return saveConfirmationDialog(editor),!1;element.classList.contains(".plaintext")&&(content=content.replace(/<p>&nbsp;<\/p>/g,"").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," "),element.classList.contains(".longtext")||(content=content.replace(/[\s\n]+/mg," ").replace(/^\s+/,"").replace(/\s+$/,"")),editor.setContent(content));setStatus("Saving content â€¦");element.setAttribute("originalText",content);const formData=new FormData;return formData.append("id",id),formData.append("value",content),fetch("/Admin/Content/FrontendEditing/FrontendDataHandler.aspx?action=save",{method:"POST",body:formData}).then(function(response){if(response.ok){if(setStatus("Content saved",{className:"success"}).fade(),editor.setDirty(!1),callbacks&&callbacks.onContentSaved)callbacks.onContentSaved(editor,response)}else if(setStatus("Save failed",{className:"alert"}),callbacks&&callbacks.onSaveFailed)callbacks.onSaveFailed(editor,response)}).catch(function(response){if(setStatus("Save failed",{className:"alert"}),callbacks&&callbacks.onSaveFailed)callbacks.onSaveFailed(editor,response)}),!0},discardChanges=function(editor){if(editor.isDirty()){const originalText=editor.getBody().getAttribute("originalText");editor.setContent(originalText);editor.setDirty(!1)}closeEditor(editor)},editorFocus=function(){status.fade()},editorBlur=function(event){const editor=event.target,originalText=editor.getBody().getAttribute("originalText"),currentText=editor.getContent({format:"html"});return originalText==currentText&&editor.setDirty(!1),saveContent(editor,!0)},translate=parent.translate?parent.translate:function(text){return text},setStatus=function(text,data){return data||(data={}),data.translate=!0,status.set(text,data)},editorsIds=function(){const idsList=[];return document.querySelectorAll(".dw-frontend-editable").forEach(function(element){idsList.push(element.id)}),idsList}();tinymce.PluginManager.add("inlineEditing",function(editor){const saveCommandName="mceInlineSave",cancelCommandName="mceInlineCancel";editor.addCommand(saveCommandName,function(){saveContent(editor,!1,{onContentSaved:function(){editor.setDirty(!1);closeEditor(editor)}})});editor.addCommand(cancelCommandName,function(){discardChanges(editor);setStatus("").fade()});editor.ui.registry.addButton("inlineSave",{icon:"save",tooltip:"Save",disabled:!1,onAction:function(){editor.execCommand(saveCommandName)}});editor.ui.registry.addButton("inlineCancel",{icon:"cancel",tooltip:"Cancel",disabled:!1,onAction:function(){editor.execCommand(cancelCommandName)}});editor.on("blur",editorBlur);editor.on("focus",editorFocus);editor.on("init",function(){editorsIds=editorsIds.filter(value=>value!==editor.id);editorsIds.length==0&&setStatus("Frontend editing ready").fade()});editor.on("deactivate",function(){if(document.querySelector(".tox-dialog-wrap"))return!1})})}();